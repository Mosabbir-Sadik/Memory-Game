<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Match</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Outfit', sans-serif; }

    .card-container { perspective: 800px; }
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }
    .card-inner.flipped { transform: rotateY(180deg); }
    .card-inner.matched { transform: rotateY(180deg); }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-back { transform: rotateY(180deg); }

    .card-container.matched .card-inner {
      animation: matchPop 0.4s ease-out;
    }
    @keyframes matchPop {
      0% { transform: rotateY(180deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.12); }
      100% { transform: rotateY(180deg) scale(1); }
    }

    .card-front::after {
      content: '?';
      font-size: 1.8rem;
      font-weight: 800;
      opacity: 0.4;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-in { animation: fadeInUp 0.5s ease-out forwards; }
    .stagger-1 { animation-delay: 0.05s; opacity: 0; }
    .stagger-2 { animation-delay: 0.1s; opacity: 0; }
    .stagger-3 { animation-delay: 0.15s; opacity: 0; }
    .stagger-4 { animation-delay: 0.2s; opacity: 0; }
    .stagger-5 { animation-delay: 0.25s; opacity: 0; }
    .stagger-6 { animation-delay: 0.3s; opacity: 0; }
    .stagger-7 { animation-delay: 0.35s; opacity: 0; }
    .stagger-8 { animation-delay: 0.4s; opacity: 0; }

    @keyframes confettiFall {
      0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(60px) rotate(360deg); opacity: 0; }
    }
    .confetti-piece {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 2px;
      animation: confettiFall 1.5s ease-out forwards;
    }

    .win-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      border-radius: 16px;
    }
    .win-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.08); }
      70% { transform: scale(0.95); }
      100% { transform: scale(1); opacity: 1; }
    }
    .win-content { animation: bounceIn 0.6s ease-out; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <main id="app-wrapper" class="h-full w-full flex items-center justify-center overflow-auto" style="background: #0f172a;">
   <div class="w-full max-w-lg mx-auto p-5 relative" id="game-area"><!-- Header -->
    <header class="text-center mb-5">
     <h1 id="game-title" class="text-3xl font-extrabold tracking-tight mb-1" style="color: #e2e8f0;">Memory Match</h1>
     <div class="flex items-center justify-center gap-4 text-sm font-semibold" style="color: #94a3b8;">
      <div>
       Moves: <span id="move-count" style="color: #38bdf8;">0</span>
      </div>
      <div>
       Pairs: <span id="pair-count" style="color: #38bdf8;">0</span> / <span id="total-pairs">8</span>
      </div>
      <div>
       Time: <span id="timer" style="color: #38bdf8;">0:00</span>
      </div>
     </div>
    </header><!-- Card Grid -->
    <div id="card-grid" class="grid grid-cols-4 gap-3 mb-5" role="list" aria-label="Memory card grid">
    </div><!-- Restart Button -->
    <div class="text-center"><button id="restart-btn" class="px-6 py-2.5 rounded-full font-bold text-sm tracking-wide transition-all duration-200 hover:scale-105 active:scale-95" style="background: #38bdf8; color: #0f172a;"> üîÑ New Game </button>
    </div><!-- Win Overlay -->
    <div id="win-overlay" class="win-overlay" style="background: rgba(15, 23, 42, 0.92);">
     <div class="win-content text-center px-6" id="confetti-container">
      <div class="text-6xl mb-3">
       üèÜ
      </div>
      <h2 id="win-text" class="text-2xl font-extrabold mb-2" style="color: #e2e8f0;">You Win!</h2>
      <p class="text-sm mb-1 font-semibold" style="color: #94a3b8;">Completed in <span id="final-moves" style="color: #38bdf8;">0</span> moves</p>
      <p class="text-sm mb-4 font-semibold" style="color: #94a3b8;">Time: <span id="final-time" style="color: #38bdf8;">0:00</span></p><button id="play-again-btn" class="px-6 py-2.5 rounded-full font-bold text-sm tracking-wide transition-all duration-200 hover:scale-105 active:scale-95" style="background: #38bdf8; color: #0f172a;"> üéÆ Play Again </button>
     </div>
    </div>
   </div>
  </main>
  <script>
    // --- Game State ---
    const EMOJIS = ['üêô', 'ü¶ä', 'üåµ', 'üîÆ', 'üé∏', 'üöÄ', 'üç©', 'üêã'];
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moves = 0;
    let locked = false;
    let timerInterval = null;
    let seconds = 0;
    let gameStarted = false;

    // --- Config ---
    const defaultConfig = {
      game_title: 'Memory Match',
      win_message: 'You Win!',
      background_color: '#0f172a',
      surface_color: '#1e293b',
      text_color: '#e2e8f0',
      accent_color: '#38bdf8',
      muted_color: '#94a3b8',
      font_family: 'Outfit',
      font_size: 16
    };

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    function startTimer() {
      if (timerInterval) return;
      timerInterval = setInterval(() => {
        seconds++;
        document.getElementById('timer').textContent = formatTime(seconds);
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function createCardElement(card, index) {
      const config = (window.elementSdk && window.elementSdk.config) || defaultConfig;
      const container = document.createElement('div');
      container.className = `card-container animate-in stagger-${(index % 8) + 1}`;
      container.setAttribute('role', 'listitem');
      container.style.aspectRatio = '1';
      container.dataset.id = card.id;

      const inner = document.createElement('div');
      inner.className = 'card-inner';

      const front = document.createElement('div');
      front.className = 'card-front';
      front.style.background = config.surface_color || defaultConfig.surface_color;
      front.style.border = `2px solid ${config.muted_color || defaultConfig.muted_color}33`;
      front.style.color = config.muted_color || defaultConfig.muted_color;
      front.style.cursor = 'pointer';

      const back = document.createElement('div');
      back.className = 'card-back';
      back.style.background = `${config.accent_color || defaultConfig.accent_color}22`;
      back.style.border = `2px solid ${config.accent_color || defaultConfig.accent_color}`;
      back.style.fontSize = '2rem';
      back.textContent = card.emoji;

      inner.appendChild(front);
      inner.appendChild(back);
      container.appendChild(inner);

      container.addEventListener('click', () => flipCard(card.id));
      return container;
    }

    function initGame() {
      stopTimer();
      seconds = 0;
      moves = 0;
      matchedPairs = 0;
      flippedCards = [];
      locked = false;
      gameStarted = false;

      document.getElementById('move-count').textContent = '0';
      document.getElementById('pair-count').textContent = '0';
      document.getElementById('timer').textContent = '0:00';
      document.getElementById('win-overlay').classList.remove('visible');

      const pairs = shuffle(EMOJIS).slice(0, 8);
      cards = shuffle([...pairs, ...pairs].map((emoji, i) => ({
        id: i,
        emoji,
        flipped: false,
        matched: false
      })));

      const grid = document.getElementById('card-grid');
      grid.innerHTML = '';
      cards.forEach((card, index) => {
        grid.appendChild(createCardElement(card, index));
      });
    }

    function flipCard(id) {
      if (locked) return;
      const card = cards.find(c => c.id === id);
      if (!card || card.flipped || card.matched) return;

      if (!gameStarted) { gameStarted = true; startTimer(); }

      card.flipped = true;
      flippedCards.push(card);

      const el = document.querySelector(`[data-id="${id}"] .card-inner`);
      if (el) el.classList.add('flipped');

      if (flippedCards.length === 2) {
        moves++;
        document.getElementById('move-count').textContent = moves;
        locked = true;

        const [a, b] = flippedCards;
        if (a.emoji === b.emoji) {
          a.matched = true;
          b.matched = true;
          matchedPairs++;
          document.getElementById('pair-count').textContent = matchedPairs;

          const elA = document.querySelector(`[data-id="${a.id}"]`);
          const elB = document.querySelector(`[data-id="${b.id}"]`);
          if (elA) elA.classList.add('matched');
          if (elB) elB.classList.add('matched');

          flippedCards = [];
          locked = false;

          if (matchedPairs === 8) {
            stopTimer();
            setTimeout(showWin, 500);
          }
        } else {
          setTimeout(() => {
            a.flipped = false;
            b.flipped = false;
            const elA = document.querySelector(`[data-id="${a.id}"] .card-inner`);
            const elB = document.querySelector(`[data-id="${b.id}"] .card-inner`);
            if (elA) elA.classList.remove('flipped');
            if (elB) elB.classList.remove('flipped');
            flippedCards = [];
            locked = false;
          }, 800);
        }
      }
    }

    function showWin() {
      const config = (window.elementSdk && window.elementSdk.config) || defaultConfig;
      document.getElementById('final-moves').textContent = moves;
      document.getElementById('final-time').textContent = formatTime(seconds);
      document.getElementById('win-text').textContent = config.win_message || defaultConfig.win_message;
      document.getElementById('win-overlay').classList.add('visible');
      spawnConfetti();
    }

    function spawnConfetti() {
      const container = document.getElementById('confetti-container');
      const colors = ['#38bdf8', '#f472b6', '#facc15', '#34d399', '#a78bfa'];
      for (let i = 0; i < 30; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        piece.style.left = `${Math.random() * 100}%`;
        piece.style.top = `${Math.random() * 40}%`;
        piece.style.animationDelay = `${Math.random() * 0.5}s`;
        piece.style.animationDuration = `${1 + Math.random() * 1}s`;
        container.appendChild(piece);
        setTimeout(() => piece.remove(), 2500);
      }
    }

    function applyConfig(config) {
      const bg = config.background_color || defaultConfig.background_color;
      const surface = config.surface_color || defaultConfig.surface_color;
      const text = config.text_color || defaultConfig.text_color;
      const accent = config.accent_color || defaultConfig.accent_color;
      const muted = config.muted_color || defaultConfig.muted_color;
      const font = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      document.getElementById('app-wrapper').style.background = bg;
      document.getElementById('game-title').style.color = text;
      document.getElementById('game-title').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('game-title').style.fontFamily = `${font}, Outfit, sans-serif`;
      document.getElementById('game-title').style.fontSize = `${fontSize * 1.9}px`;

      // Stats styling
      const statContainer = document.getElementById('game-title').nextElementSibling;
      if (statContainer) {
        statContainer.style.color = muted;
        statContainer.style.fontFamily = `${font}, Outfit, sans-serif`;
        statContainer.style.fontSize = `${fontSize * 0.85}px`;
        statContainer.querySelectorAll('span[id]').forEach(span => {
          if (['move-count', 'pair-count', 'timer'].includes(span.id)) {
            span.style.color = accent;
          }
        });
        const totalSpan = document.getElementById('total-pairs');
        if (totalSpan) totalSpan.style.color = accent;
      }

      // Card colors
      document.querySelectorAll('.card-front').forEach(el => {
        el.style.background = surface;
        el.style.borderColor = `${muted}33`;
        el.style.color = muted;
      });
      document.querySelectorAll('.card-back').forEach(el => {
        el.style.background = `${accent}22`;
        el.style.borderColor = accent;
      });

      // Buttons
      const restartBtn = document.getElementById('restart-btn');
      restartBtn.style.background = accent;
      restartBtn.style.color = bg;
      restartBtn.style.fontFamily = `${font}, Outfit, sans-serif`;
      restartBtn.style.fontSize = `${fontSize * 0.85}px`;

      const playBtn = document.getElementById('play-again-btn');
      playBtn.style.background = accent;
      playBtn.style.color = bg;
      playBtn.style.fontFamily = `${font}, Outfit, sans-serif`;
      playBtn.style.fontSize = `${fontSize * 0.85}px`;

      // Win overlay
      document.getElementById('win-overlay').style.background = `${bg}ee`;
      document.getElementById('win-text').style.color = text;
      document.getElementById('win-text').textContent = config.win_message || defaultConfig.win_message;
      document.getElementById('win-text').style.fontFamily = `${font}, Outfit, sans-serif`;
      document.getElementById('win-text').style.fontSize = `${fontSize * 1.5}px`;

      document.querySelectorAll('#win-overlay p').forEach(p => {
        p.style.color = muted;
        p.style.fontFamily = `${font}, Outfit, sans-serif`;
        p.style.fontSize = `${fontSize * 0.85}px`;
      });
      const finalMoves = document.getElementById('final-moves');
      const finalTime = document.getElementById('final-time');
      if (finalMoves) finalMoves.style.color = accent;
      if (finalTime) finalTime.style.color = accent;
    }

    // --- Event Listeners ---
    document.getElementById('restart-btn').addEventListener('click', initGame);
    document.getElementById('play-again-btn').addEventListener('click', initGame);

    // --- SDK Init ---
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          applyConfig(config);
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (v) => { config.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (v) => { config.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (v) => { config.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (v) => { config.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            },
            {
              get: () => config.muted_color || defaultConfig.muted_color,
              set: (v) => { config.muted_color = v; window.elementSdk.setConfig({ muted_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (v) => { config.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (v) => { config.font_size = v; window.elementSdk.setConfig({ font_size: v }); }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['game_title', config.game_title || defaultConfig.game_title],
          ['win_message', config.win_message || defaultConfig.win_message]
        ])
      });
    }

    // --- Start ---
    initGame();
    applyConfig(defaultConfig);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cb4ecccf5ac9cba',t:'MTc3MDY1NjQ0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>